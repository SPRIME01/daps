#!/bin/bash
#
# webhelpindexer: creates index file(s) needed for the webhelp output
# taken from the build.xml file of  the DocBook XSL distribution
#
# (C) 2012 Thomas Schraitle <toms@opensuse.org>

. /usr/share/java-utils/java-functions

MAIN_CLASS=com.nexwave.nquindexer.IndexerMain

# The DocBook XSLT stylesheet path:
# DB="/usr/share/xml/docbook/stylesheet/nwalsh/current"
# "${output-dir}/content"
#HTMLDIR=""
# "${webhelp.indexer.language}"
#INDEXERLANGUAGE=""
# "${html.extension}"
#HTMLEXTENSION=""
# "${enable.stemming}"
#DOSTEM=""
# "${toc.file}"
#TOCFILE=""

BASE_FLAGS="-Dorg.xml.sax.driver=org.ccil.cowan.tagsoup.Parser -Djavax.xml.parsers.SAXParserFactory=org.ccil.cowan.tagsoup.jaxp.SAXFactoryImpl"

if [[ ! -n ${DB} ]]; then
echo "Environment variable DB not set. DB points to the path for the DocBook XSL stylesheets"
exit 1
fi

if [[ -n ${HTMLDIR} ]]; then
BASE_FLAGS="$BASE_FLAGS -DhtmlDir=${HTML_DIR} "
fi
if [[ -n ${INDEXERLANGUAGE} ]]; then
BASE_FLAGS="$BASE_FLAGS -DindexerLanguage=${INDEXERLANGUAGE} "
fi
if [[ -n ${HTMLEXTENSION} ]]; then
BASE_FLAGS="$BASE_FLAGS -DhtmlExtension=${HTMLEXTENSION} "
fi
if [[ -n ${DOSTEM} ]]; then
BASE_FLAGS="$BASE_FLAGS -DdoStem=${DOSTEM} "
fi
if [[ -n ${TOCFILE} ]]; then
BASE_FLAGS="$BASE_FLAGS -DtocFile=${TOCFILE} "
fi


CLASSPATH="$CLASSPATH:$(build-classpath-directory $DB/extensions 2>/dev/null)"


# Set parameters
set_jvm
# set_classpath $BASE_JARS
set_flags $BASE_FLAGS
set_options $BASE_OPTIONS

# Let's start
run $args $PARAMS