<!-- Converted by db4-upgrade version 1.1 -->

<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xi="http://www.w3.org/2001/XInclude" version="5.0" xml:id="cha.smt">
  <title>Subscription Management</title>
  <!--<title>Configuring Clients to Use &smt;</title>-->
  <para>
  Any machine running SUSE Linux Enterprise Server <phrase role="productname"><phrase os="osuse">12.2</phrase><phrase os="sles;sled;slerte">12</phrase></phrase> or SUSE Linux Enterprise Desktop <phrase role="productname"><phrase os="osuse">12.2</phrase><phrase os="sles;sled;slerte">12</phrase></phrase> can be
  configured to register against local Subscription Management Tool server to download software
  updates instead of communicating directly with the SUSE Customer Center and the NU
  servers. To use an SMT server for client registration and as a local
  update source, you must configure the SMT server in your network first.
  The SMT server software is distributed as an add-on for SUSE Linux Enterprise Server and its
  configuration is described in the <emphasis>Subscription Management Tool Guide</emphasis>. There is no need to install
  any add-on on the clients to be configured for registering against an
  SMT server.
 </para>
  <para>
  To register a client against an SMT server, you need to equip the client
  with the server's URL. As client and server communicate via the HTTPS
  protocol during registration, you also need to make sure the client trusts
  the server's certificate. In case your SMT server is set up to use the
  default server certificate, the CA certificate will be available on the
  SMT server via HTTP protocol at
  <literal>http://<replaceable>FQDN</replaceable>/smt.crt</literal>. In this
  case you do not need to concern yourself with the certificate: the
  registration process will automatically download the CA certificate from
  there, unless configured otherwise. You must enter a path to the server's
  CA certificate if the certificate was issued by an external certificate
  authority.
 </para>
  <!-- fs 2014-07-03: Si this still true for suse.com? Commenting for now
 <note>
  <title>Registering Against <literal>*.novell.com</literal> Subdomain</title>
  <para>
   If you try to register against any <literal>*.novell.com</literal>
   subdomain, the certificate will not be downloaded during registration
   (for security reasons), and certificate handling will not be done. In
   such cases, use a different domain name or a plain IP address.
  </para>
 </note>
-->
  <para>
  There are several ways to provide this information and to configure the
  client machine to use SMT. The first way is to provide the needed
  information via kernel parameters at boot time. The second way is to
  configure clients using an AutoYaST profile. There is also a script
  distributed with Subscription Management Tool, <command>clientSetup4SMT.sh</command>, which
  can be run on a client to make it register against a specified SMT
  server. These methods are described in the following sections:
 </para>
  <sect1 xml:id="smt.client.parameters">
    <title>Using Kernel Parameters to Access an SMT Server</title>
    <para>
   Any client can be configured to use SMT by providing the following
   kernel parameters during machine boot: <literal>regurl</literal> and
   <literal>regcert</literal>. The first parameter is mandatory, the latter
   is optional.
  </para>
    <variablelist>
      <varlistentry>
        <term>regurl</term>
        <listitem>
          <para>
      URL of the SMT server. The URL needs to be in the following format:
      <literal>https://<replaceable>FQDN</replaceable></literal> with
      <replaceable>FQDN</replaceable> being the fully qualified host name of
      the SMT server. It must be identical to the FQDN of the server
      certificate used on the SMT server. Example:
     </para>
          <screen>regurl=https://smt.example.com</screen>
        </listitem>
      </varlistentry>
    </variablelist>
    <warning>
      <title>Beware of Typing Errors</title>
      <para>
    Make sure the values you enter are correct. If <literal>regurl</literal>
    has not been specified correctly, the registration of the update source
    will fail.
   </para>
    </warning>
    <warning>
      <title>Change of SMT Server Certificate</title>
      <para>
    If the SMT server gets a new certificate from a new and untrusted CA,
    the clients need to fetch the new CA certificate file. This is done
    automatically with the registration process but only if a URL was used
    at installation time to retrieve the certificate, or if the
    <literal>regcert</literal> parameter was omitted and thus, the default
    URL is used. If the certificate was loaded using any other method (such
    as local path), the CA certificate will not be updated.
   </para>
    </warning>
  </sect1>
  <sect1 xml:id="smt.client.autoyast">
    <title>Configuring Clients Using AutoYaST Profile</title>
    <para>
   Clients can be configured to register with SMT server via AutoYaST profile.
   For general information about creating AutoYaST profiles and preparing
   automatic installation, refer to
   <xref linkend="cha.deployment.autoinst"/>. In this section, only
   SMT specific configuration is described.
  </para>
    <para>
   To configure SMT specific data using AutoYaST, follow these steps:
  </para>
    <procedure>
      <step>
        <para>
     As <systemitem class="username">root</systemitem>, start YaST and select <menuchoice><guimenu>Miscellaneous</guimenu><guimenu>Autoinstallation</guimenu></menuchoice> to start the graphical AutoYaST front-end.
    </para>
        <para>
     From a command line, you can start the graphical AutoYaST front-end with
     the <command>yast2 autoyast</command> command.
<!--To start the module with
     ncurses user interface, use the <command>yast autoyast</command>
     command.--></para>
      </step>
      <step>
        <para>
     Open an existing profile using
     <menuchoice><guimenu>File</guimenu><guimenu>Open</guimenu></menuchoice>,
     create a profile based on the current system's configuration using
     <menuchoice><guimenu>Tools</guimenu><guimenu>Create Reference
     Profile</guimenu></menuchoice>, or work with an empty profile.
    </para>
      </step>
      <step>
        <para>
     Select <menuchoice><guimenu>Support</guimenu><guimenu>SUSE Customer
     Center Configuration</guimenu></menuchoice>. An overview of the current
     configuration is shown.
    </para>
      </step>
      <step>
        <para>
     Click <guimenu>Edit</guimenu>.
    </para>
      </step>
      <step>
        <!--
     <remark>mdejmek: to register automatically while installing...?</remark>
    <para>
     To register while installing automatically, select
     <guimenu>Run Product Registration</guimenu>.
    </para>
    -->
        <para>
     To register while installing automatically, select <guimenu>Run Product
     Registration</guimenu>.
    </para>
      </step>
      <step>
        <para>
     Set the URL of the <guimenu>SMT Server</guimenu> and, optionally, the
     location of the <guimenu>SMT Certificate</guimenu>. The possible
     values are the same as for the kernel parameter
     <literal>regurl</literal>. The possible values are the same as for the
     kernel parameters <literal>regurl</literal> and
     <literal>regcert</literal> (see
     <xref linkend="smt.client.parameters"/>). The only exception is that
     the <literal>ask</literal> value for <literal>regcert</literal> does
     not work in AutoYaST, because it requires user interaction. If using it,
     the registration process will be skipped.
    </para>
        <para>
     If you go through the register process, YaST can use add-ons
     (extensions or modules) from a SUSE Customer Center registration server. With SUSE Customer Center
     you can register and install new products, for example the SUSE Software Development Kit, High Availability,
     GEO Clustering for SUSE Linux Enterprise High Availability Extension, and others directly available from your SUSE Customer Center. With SUSE Customer Center it
     is even possible to install the latest patch level.
    </para>
      </step>
      <step>
        <para>
     Perform all other configuration needed for the systems to be deployed.
    </para>
      </step>
      <step>
        <para>
     Select <menuchoice><guimenu>File</guimenu><guimenu>Save As</guimenu></menuchoice> and enter a file name for the profile, such as
     <filename>autoinst.xml</filename>.
    </para>
      </step>
    </procedure>
  </sect1>
  <sect1 xml:id="smt.client.clientsetupscript">
    <title>Configuring Clients Using the clientSetup4SMT.sh Script</title>
    <para>
   The <command>/usr/share/doc/packages/smt/clientSetup4SMT.sh</command>
   script is provided with SMT. This script allows to configure a client
   machine to use a SMT server or to reconfigure it to use a different
   SMT server.
  </para>
    <para>
   To configure a client machine to use SMT with the
   <command>clientSetup4SMT.sh</command> script, follow these steps:
  </para>
    <procedure>
      <step>
        <para>
     Copy the
     <filename>/usr/share/doc/packages/smt/clientSetup4SMT.sh</filename>
     script from your SMT server to the client machine.
    </para>
      </step>
      <step>
        <para>
     As <systemitem class="username">root</systemitem>, execute the script on the client machine. The script can
     be executed in two ways:
    </para>
        <itemizedlist>
          <listitem>
            <para>
       The script name is followed by the registration URL:
      </para>
            <screen>./clientSetup4SMT.sh <replaceable>registration_URL</replaceable></screen>
            <para>
       for example:
      </para>
            <screen>./clientSetup4SMT.sh  https://smt.example.com/center/regsvc</screen>
          </listitem>
          <listitem>
            <para>
       The script name is followed by the <option>--host</option> option
       followed by host name of the SMT server:
      </para>
            <screen>./clientSetup4SMT.sh  --host <replaceable>server_hostname</replaceable></screen>
            <para>
       for example:
      </para>
            <screen>./clientSetup4SMT.sh --host  smt.example.com</screen>
          </listitem>
        </itemizedlist>
        <para>
     The script downloads the server's CA certificate.
    </para>
        <important>
          <title>The <option>--host</option> Parameter</title>
          <para>
      The host name that needs to be provided with the
      <option>--host</option> parameter, needs to be the same name the
      certificate is issued for. Furthermore, if the name in the certificate
      is the fully qualified host name (for example, add
      smt.example.com), it needs to be entered as such—entering
      the <quote>short</quote> name (smt) will cause the
      <command>clientSetup4SMT.sh</command> script to fail.
     </para>
        </important>
      </step>
      <step>
        <para>
     Accept the server's CA certificate by pressing <keycap>y</keycap>.
    </para>
      </step>
      <step>
        <para>
     The script performs all necessary modifications on the client. If
     wanted, the registration itself can be performed by the script.
    </para>
      </step>
      <step>
        <para><remark>toms 2014-05-19: http://bugzilla.novell.com/show_bug.cgi?id=857639#c11
        "How the new SUSEConnect will do it is still unclear." -- mc
      </remark>
     Perform a registration by executing <command>SUSEConnect</command><!--or
     running <command>yast2 inst_suse_register</command> module-->
     on the client.
    </para>
      </step>
    </procedure>
    <!--
    this is SLE11 docs, it is probably not necessary to mention all the
    supported system versions
   -->
    <!--
   <para>
    The <command>clientSetup4SMT.sh</command> script works with &sle; 10 SP1 and SP2 systems.
   </para>
   -->
  </sect1>
  <sect1 xml:id="sec.smt.register">
    <title>Registering Clients Against an SMT Test Environment</title>
    <remark>toms 2014-05-19: http://bugzilla.novell.com/show_bug.cgi?id=857639#c11
        "How the new SUSEConnect will do it is still unclear." -- mc
        
       "SMT staging. Means not register against the normal env $RCE/... but 
       against the "testing" stage.
       SUSEConnect needs to submit an extra paramter specified via commandline. 
       And this is not defined nor implemented yet." -- mc 
  </remark>
    <para>
   To configure a client to register against the test environment instead of
   the production environment, use <command>SUSEConnect</command> on the
   client machine:
  </para>
    <screen>SUSEConnect -r <replaceable>REG_CODE</replaceable></screen>
    <para>
   Replace <replaceable>REG_CODE</replaceable> with your product's
   registration code. You can find it at the
   <link xlink:href="http://scc.suse.com"/> site.
  </para>
    <!-- 
     toms 2014-05-19: Not sure if this procedure always work (especially with
                      the above comment)
     
     1. Log in to http://scc.suse.com with your account credentials.
     2. Click the "Subscriptions" tab.
     3. Search for your product in the search field on the left side or
        choose one entry from the list.
     4. Click the correct product name. The new page contains the following
        information:
        
                    Start date    - - -
                   Expiry date    January 1, 2100 
             Registration code    69302@HOU-EXT-RES-fe55461921 
  Number of registered systems    0 of ∞ 
     5. Run SUSEConnect on your client which needs to be registered.
        Use the registration code from the previous step.
        # SUSEConnect -r "69302@HOU-EXT-RES-fe55461921"
     6. Check what repositories have been added:
        # zypper sl
  
  -->
    <para>
   For more information about using SMT with a test environment, refer to
   the <emphasis>Subscription Management Tool Guide</emphasis>.
  </para>
  </sect1>
</chapter>
